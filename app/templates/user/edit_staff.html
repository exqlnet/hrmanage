{% extends 'base.html' %}
{% block title %}编辑 {{ u.id }}{% endblock %}
{% block head %}
    <script>
        /* 函数：设定新菜单的事件 */
        function set_p_menu(){
    $('ul.p_menu li a').each(function(){

        $(this).click(function(){
            var arrow = '<span class="caret"></span>';
            var a = $(this).parent().parent().prevAll('a');
            var str = $(this).text();
            a.text(str);
            a.append(arrow);
        $('input[name=position]').val(str);

        })
    })}
    /* 函数：设置登陆密码框是否显示 */
    function change_password_condition() {
        if ($('input#login_permission').is(':checked')) {
            $('div.edit-password').show()
        }
        else{
            $('div.edit-password').hide()
        }

    }
    $(document).ready(function(){
                /* 读取json并渲染html */
        var xmlhttp;
        if (window.XMLHttpRequest)
        {
            //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
            xmlhttp=new XMLHttpRequest();
        }
        else
        {
            // IE6, IE5 浏览器执行代码
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlhttp.onreadystatechange=function()
        {

            if (xmlhttp.readyState==4 && xmlhttp.status==200)
            {
                var dp_json = JSON.parse(xmlhttp.responseText);
                for (var key in dp_json){
                    var d_str = '<li><a href="#">'+ key +'</a></li>';
                    $('.d_menu').append(d_str);


                }
                /* 渲染position下拉菜单 */
                var p_menu = $('p_menu');
                p_menu.empty();
                var c = "{{ u.department.name }}";

                for(var i=0;i<dp_json[c].length;i++){
                var p_str = dp_json[c][i];
                p_str = '<li><a href="#">'+ p_str +'</a></li>';
                $('.p_menu').append(p_str)

            }
            set_p_menu();
                /* 设置登陆密码框是否显示 */
                change_password_condition();

                /* 设置允许登陆复选框事件 */
                $('input#login_permission').click(function(){
                    change_password_condition()
                });

                /* 设置保存按钮事件 */
                /*
                $('button#save_info').click(function(){
                    .ajax(
                        {
                            type:'post',
                            url: ''
                        }
                    )
                });*/
                /* 开始设置事件 */
                var depart_li = $('ul.d_menu li a');
                depart_li.each(function(){
                    $(this).click(function(){
                        var key = $(this).text();
                        var arrow = '<span class="caret"></span>';
                        var a = $(this).parent().parent().prevAll('a')
                        a.text(key);
                        a.append(arrow);
                        $('input[name=department]').val(key);
                        /* 清空和添加 p_menu */
                        $('.p_menu').empty();
                        for(var i=0;i<dp_json[key].length;i++){
                            var p_str = dp_json[key][i];
                            p_str = '<li><a href="#">'+ p_str +'</a></li>';
                            $('.p_menu').append(p_str)
                        }
                        set_p_menu();
                    })
                })

            }
        };
        xmlhttp.open("GET","/batch_staff/getdepartandposition",true);
        xmlhttp.send();

    })
    </script>
        <style>
    div#div-edit{
        margin-top: 15px;
        margin-bottom: 15px;
    }
    div.panel-default{
        margin-top: 15px;
    }
    </style>
{% endblock %}
{% block body %}
    <div class="container" style="background: white;">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">修改{{ u.position.name }}{{ u.id }}的信息</h3>
        </div>
        <div class="panel-body">
            <form method="POST">
<div id="div-input" >
<div class="input-group col-md-4" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">姓名</span>
  <input value="{{ u.name }}" type="text" class="form-control" id="name" name="name" placeholder="张三" aria-describedby="basic-addon1" maxlength="8">
</div>
    <div class="input-group col-md-4" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">部门</span>
        <input type="text" name="department" maxlength="16" hidden value="{{ u.department.name }}">
     <a href="#" class="dropdown-toggle department" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ u.department.name }}<span class="caret"></span></a>
          <ul class="dropdown-menu d_menu">

          </ul>
    </div>
    <div class="input-group col-md-4" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">职位</span>
                <input type="text" name="position" maxlength="16" hidden value="{{ u.position.name }}">
       <a href="#" class="dropdown-toggle position" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ u.position.name }}<span class="caret"></span></a>
          <ul class="dropdown-menu p_menu">

          </ul>
    </div>
            <div class="input-group" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">出生年月</span>
  <input name="birth" onkeyup="(this.v=function(){this.value=this.value.replace(/[^\d/]/,'');}).call(this)" onblur="this.v();"  type="text" class="form-control" id="birth" placeholder="格式：2018/1/1" aria-describedby="basic-addon1" maxlength="11" value="{{ u.birth.strftime('%Y/%m/%d') }}">
    </div>
    <div class="input-group" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">家庭住址</span>
  <input name="address" type="text" class="form-control" id="address" placeholder="江西省南昌市" aria-describedby="basic-addon1" maxlength="64" value="{{ u.address }}">
    </div>
    <div class="input-group" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">联系电话</span>
  <input name="phone" onkeyup="(this.v=function(){this.value=this.value.replace(/[^\d\-]/,'');}).call(this)" onblur="this.v();" type="text" class="form-control" id="phone" placeholder="0791-123456" aria-describedby="basic-addon1" maxlength="11" value="{{ u.phone }}">
    </div>
    <hr>
       <div class="input-group" id="div-edit">
            <label><input name="login_permission" id="login_permission" type="checkbox" {% if u.login_permission %}checked{% endif %}>允许登陆</label>
       </div>
       <div class="input-group edit-password" id="div-edit">
  <span class="input-group-addon" id="basic-addon1">登陆密码</span>
  <input name="password" type="text" class="form-control" id="password"  aria-describedby="basic-addon1" maxlength="16">
    </div>
    <hr>
<button class="btn btn-primary" id="save_info" type="submit">保存信息</button>
</div></form>
</div>
</div>
    </div>
{% endblock %}